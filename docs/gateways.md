Шлюзы
===

Шлюзы - это устройства, которые позволяют внешним приложениям взаимодействовать с Zigbee-устройствами и сетью вцелом.

Обычно, производитель Zigbee-устройств поставляет также собственный шлюз. Такой шлюз организует сеть, управляет устройствами и их подключением, а также отправляет куда-то в облака все данные с этих устройств. Всё для того, чтобы мобильное приложение тоже смогло получить эти данные и вы смогли их использовать.

Некоторые щедрые производители дают возможность подключаться к своим шлюзам локально (developer mode, не обращаясь в облако) и получать данные об устройствах внутри локальной сети. С такими шлюзами очень хорошо можно интегрироваться и именно это их свойство используют при подключении их к системам "умного дома".

В большинстве случаев, шлюзы могут обслуживать только устройства своего производителя/бренда. Поэтому, для организации сети из разнородных устройств, придётся создавать несколько различных сетей на различных шлюзах.

Варианты организации координации сети Zigbee
---------------------------------------------

|  | Готовое устройство (хабы, шлюзы, колонки) | DIY одноплатник с zigbee | DIY дополнения к компьютеру/одноплатнику  (модуль, шилд, стик, сетевой-стик) |
|--|-------------------------------------------|--------------------------|------------------------------------------------------------------------------|
| Популярность | ⭐⭐⭐ | ⭐ | ⭐⭐ |
| Оборудование  | + не требуется доп оборудование, zigbee чип встроен | + не требуется доп оборудование, zigbee чип встроен | подойдет любой компьютер или одноплатник, нужен дополнительный модуль/шилд/стик с zigbee чипом |
| Софт  | + встроенный софт для работы с zigbee чипом <br> + имеют собственные приложения для управления <br> - обычно хаб относится к определенной экосистеме и работает с устройствами этой экосистемы (бывают исключения) | - нужен дополнительный софт для работы с zigbee чипами <br> + этот софт позволяет подключать устройства произвольных производителей, нет привязки к экосистеме | - нужен дополнительный софт для работы с zigbee чипами <br> + этот софт позволяет подключать устройства произвольных производителей, нет привязки к экосистеме |
| Примечание | бываю хабы, у которых можно сменить прошивку (sonoff/ewelink хабы, aqara хабы, некоторые tuya хабы) и тогда можно использовать сторонний софт для реализации zigbee-координатора (см. вариант **DIY одноплатник с zigbee**) | такие одноплатники идут с открытой ОС для установки доп софта (редкие представители), либо являются взломанными zigbee-хабами |  |

Готовые хабы, экосистемы
------------------------
Разные Zigbee-шлюзы одного производителя/бренда объединяются в одну экосистему:

* Aqara
* Tuya и бренды Moes/Zemismart/BSEED/...
* eWelink/Sonoff
* Яндекс
* Sber
* IKEA
* Shelly


|  | Aqara | Яндекс | Sonoff | Tuya | Сбер | SprutHub |
|--|-------|--------|--------|------|------|----------|
| Популярность | ⭐⭐⭐ | ⭐⭐ | ⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐ |
| Хабы | Множество вариантов хабов.<br>Работают с устройствами Aqara. Могут быть хакнуты и использоваться как сетевые-стики | Яндекс хаб и Яндекс станции с Zigbee. <br> Работают с устройствами разных производителей и соответстветствующих стандарту Zigbee 3.0 | Хабы работают с устройствами экосистемы Sonoff/eWelink. <br> Хабы могут быть хакнуты и использоваться как сетевые-стики, либо на них можно установить Tasmota и использовать как координатор. <br> iHost более универсальных хаб и там можно сменить систему на HAOS и поставить дополнительный софт. | Множество брендов и хабов. Работают со всем множеством устройств экосистемы Tuya. <br> Некоторые хаба могут быть хакнуты и использоваться как сетевые-стики. | Работают с устройствами разных производителей и соответстветствующих стандарту Zigbee 3.0 | Работают с устройствами разных производителей и соответстветствующих стандарту Zigbee 3.0. <br> Поддержка zigbee устройств расширяется шаблонами. |

Универсальные Zigbee-шлюзы
==========================
Но в природе существуют и универсальные шлюзы, которые поддерживают работу с устройствами разных производителей и не шлют данные куда-то далеко, а предоставляют их локально по сети или через USB/UART.

Дополнения к компьютеру
-----------------------

|  | Модуль или шилд | Стик | Сетевой стик |
|--|-----------------|------|--------------|
| Популярность | ⭐ | ⭐⭐⭐ | ⭐⭐ |
|  | Вставляется внутрь компьютера или на GPIO разъем. При подключении в системе появляется отдельный порт для взаимодействия с zigbee-чипом. | Подключается к USB-порту компьютера. <br> При подключении в системе появляется отдельный порт для взаимодействия с zigbee-чипом. | Подключается в локальную сеть. Для взаимодействия следует указать ip-адрес и порт, на котором будет доступен zigbee-чип. |

Для работы с zigbee-чипами нужен специальный софт
-------------------------------------------------

|  | [Zigbee2mqtt](https://www.zigbee2mqtt.io/) | [ZHA Home Assistant](https://www.home-assistant.io/integrations/zha/) | [HOMEd Zigbee](https://wiki.homed.dev/zigbee/) | [SprutHub](https://spruthub.ru/) | [Phoscon, deConz](https://phoscon.de/en/landing) | [Tasmota2Zigbee](https://tasmota.github.io/docs/Zigbee/) | [SLS](https://slsys.io/docs/) |
|--|--------------------------------------------|---|---|---|---|---|---|
| Популярность | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐⭐ | ⭐ | ⭐ | ⭐⭐ |
| Платформа | Работает на любой платформе, где запускается NodeJs. <br> OpenSource, написан на TypeScript. | Является частью HA и работает на любой платформе. <br> OpenSource, написан на Python. | Является частью HOMEd <br> Компилируется под любую платформу где доступна библиотека QT. <br> OpenSource, написан на С++. | Является частью SprutHub. <br> Может быть приобретен и установлен на ограниченный набор платформ. | Является частью Phoscon. <br> OpenSource, написан на C++. | Является частью прошивки Tasmota <br> Компилируется под чипы ESP32 <br> OpenSource, написан на C. | Компилируется под чипы ESP32 |
| Чипы | TI cc253*, cc2652/cc1352 <br> SL efr32mg12, efr32mg21, efr32mg24 <br> RaspBee, Conbee <br> ZiGate <br> ZBOSS | TI cc253*, cc2652/cc1352 <br> SL efr32mg12, efr32mg21, efr32mg24 <br> RaspBee, Conbee <br> ZiGate <br> ZBOSS | TI cc253*, cc2652/cc1352 <br> SL efr32mg12, efr32mg21 <br> ZBOSS | SL efr32mg21 | RaspBee, Conbee | TI cc253*, cc2652/cc1352 <br> SL efr32mg12, efr32mg21 | TI cc253*, cc2652/cc1352 |
| Поддержка новых устройств | Пользовательские расширения | Пользовательские расширения | Пользовательские расширения | Пользовательские расширения |Осущестсвляется разработчиком | Осущестсвляется разработчиком | Осущестсвляется разработчиком |
| Ресурсоемкость | Требовательный к ресурсам | Требовательный к ресурсам | Не требовательный | Не требовательный | Не требовательный | Не требовательный | Не требовательный |

Zigbee-чипы для роли координатора
---------------------------------

|  | TI cc2530 cc2531 cc2538 | TI cc1352 cc2652 | SL EFR32MG12 | SL EFR32MG21 EFR32MG24 | deConz | NXP JN5168 JN5169 | Nordic nRF5340 nRF52840 nRF52833 nRF21540 | ESP32 C6 H2 C5 |
|--|-------------------------|------------------|--------------|------------------------|--------|-------------------|-------------------------------------------|---------------|
| Популярность | ⭐⭐ | ⭐⭐⭐ | ⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐ | ⭐ |  |
| Состояние |Уже морально устаревшие чипы, но вполне работоспособные. | Современный чип | Уже морально устаревшие чипы, но вполне работоспособные. | Современный чип | Морально устаревший чип. Новые Conbee стики идут на чипе EFR32 | Современные чипы, но на них перестали делать zigbee координаторы. | Современные чипы, но для координаторов стек ZBOSS еще не полностью изучен. | Современные чипы, но для координаторов стек ESP/ZBOSS еще не полностью изучен. |
| Прошивки | Обновление прошивок не будет | Редкие обновления | Обновление прошивок не будет | Частые обновления | Обновление прошивок не будет | Обновление прошивок не будет |  |
| Где есть | Выпускались DIY стики (v2, v3). <br> Выпускался Sonoff Dongle. Много стиков на Aliexpress. | Выпускались DIY стики (v4). <br> Sonoff Dongle-P. Шлюз Sonoff Bridge Pro | Стик и шилд Elelabs | Выпускались DIY стики (v5, v6) <br> Sonoff Dongle-E, Sonoff Dongle-M, Sonoff Dongle-MG24, Sonoff Dongle-LMG24 <br> Хакнутые шлюзы Aqara | Шилды raspBee, стики Conbee 1, 2 | Стики и шилды ZiGate. Хакнутые шлюзы Xiaomi/Aqara. | Стики на Aliexpress |  |
